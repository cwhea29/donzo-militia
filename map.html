<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Donzo Militia â€” Map</title>
<link rel="icon" href="DM_2.png">
<link rel="stylesheet" href="css/main.css">
<link rel="stylesheet" href="css/map.css">
</head>
<body class="map-page">

<!-- Nav injected by nav.js -->

<!-- â”€â”€ MAP CONTROLS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="map-controls">

  <!-- MAP LAYERS -->
  <div class="ctrl-group">
    <span class="ctrl-label">Layer</span>
    <button class="map-tab active" data-map="atlas"
            onclick="DM.map.switchMap('atlas',this)">Atlas</button>
    <button class="map-tab" data-map="roadmap"
            onclick="DM.map.switchMap('roadmap',this)">Roadmap</button>
    <button class="map-tab" data-map="satellite"
            onclick="DM.map.switchMap('satellite',this)">Satellite</button>
  </div>

  <!-- ZONES -->
  <div class="ctrl-group">
    <span class="ctrl-label">Zone</span>
    <button class="zone-tab active" data-zone="mainland"
            onclick="DM.map.switchZone('mainland',this)">Los Santos</button>
    <button class="zone-tab" data-zone="cayo"
            onclick="DM.map.switchZone('cayo',this)">â˜  Cayo Perico</button>
  </div>

  <!-- ACTIONS -->
  <div class="ctrl-right">
    <!-- Place marker â€” shown only if user has permission -->
    <button class="place-btn hidden" id="place-btn"
            onclick="DM.map.togglePlaceMode()">ğŸ“ Place Marker</button>

    <!-- User management â€” shown only for Commander (level 4) -->
    <button class="ctrl-btn hidden" id="user-mgmt-btn"
            onclick="DM.map.openUserMgmt()">ğŸ‘¥ Users</button>

    <!-- Reset view -->
    <button class="ctrl-btn" onclick="DM.map.resetView()">âŒ– Reset View</button>

    <!-- Sidebar toggle -->
    <button class="ctrl-btn" onclick="DM.map.toggleSidebar()">Locations â–¾</button>
  </div>

</div>

<!-- â”€â”€ MAP WRAPPER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="map-wrap" id="map-wrap"
     onclick="DM.map.onMapClick(event)"
     onmousemove="DM.map.onMapMouseMove(event)">

  <div id="pan-container">
    <div id="zoom-layer">
      <!--
        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        â•‘  MAP IMAGE FILES                                   â•‘
        â•‘  Place these inside the  images/maps/  folder:    â•‘
        â•‘                                                    â•‘
        â•‘  Los Santos:                                       â•‘
        â•‘    GTAV_ATLUS.jpg                                  â•‘
        â•‘    GTAV-HD-MAP-roadmap.jpg                         â•‘
        â•‘    GTAV-HD-MAP-satellite.jpg                       â•‘
        â•‘                                                    â•‘
        â•‘  Cayo Perico:                                      â•‘
        â•‘    GTAV-CAYO-atlas.jpg                             â•‘
        â•‘    GTAV-CAYO-roadmap.jpg                           â•‘
        â•‘    GTAV-CAYO-satellite.jpg                         â•‘
        â•‘                                                    â•‘
        â•‘  Location images â†’ images/locations/              â•‘
        â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      -->
      <img id="map-img" alt="GTA V Map" draggable="false">
      <div id="markers-layer"></div>
    </div>
  </div>

  <!-- No image fallback -->
  <div id="map-no-image" class="hidden">
    <div class="no-image-text">
      // MAP IMAGE NOT FOUND<br>
      <span style="opacity:.5;font-size:9px;">
        Add images to the images/maps/ folder<br>
        See comments in map.html for filenames
      </span>
    </div>
  </div>

  <!-- SIDEBAR -->
  <div class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="sidebar-title">LOCATIONS</div>
      <button class="sidebar-close" onclick="DM.map.toggleSidebar()">âœ•</button>
    </div>

    <div class="sidebar-search">
      <input type="text" placeholder="// Search locations..."
             oninput="DM.map.renderSidebar(this.value)"
             id="sidebar-search-input">
    </div>

    <div class="sidebar-stats">
      <div class="stat-item">
        <span class="stat-num" id="stat-mainland">0</span>
        Los Santos
      </div>
      <div class="stat-item">
        <span class="stat-num cayo-num" id="stat-cayo">0</span>
        Cayo
      </div>
    </div>

    <div class="sidebar-list" id="sidebar-list">
      <div class="sidebar-empty">// LOADING LOCATIONS...</div>
    </div>
  </div>

</div>

<!-- â”€â”€ STATUS BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="statusbar">
  <div class="statusbar-item">
    <div class="status-dot" id="status-dot"></div>
    <span id="mode-label">VIEW MODE</span>
  </div>
  <div class="statusbar-item">
    ZONE: <span class="status-val" id="zone-label">LOS SANTOS</span>
  </div>
  <div class="statusbar-item">
    MARKERS: <span class="status-val" id="marker-count">â€”</span>
  </div>
  <div class="statusbar-item statusbar-right" id="coords-display">
    X: â€” / Y: â€”
  </div>
</div>

<!-- â”€â”€ ADD MARKER MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="modal-overlay hidden" id="add-modal">
  <div class="modal">
    <div class="modal-header">
      <span class="modal-icon">ğŸ“</span>
      <div class="modal-title">NEW LOCATION</div>
      <button class="modal-close" onclick="DM.map.closeAddModal()">âœ•</button>
    </div>
    <div class="modal-body">

      <div class="form-group">
        <label>// Location Name *</label>
        <input type="text" id="m-name" placeholder="e.g. Maze Bank Arena">
      </div>

      <div class="form-group">
        <label>// Description (optional)</label>
        <textarea id="m-desc" placeholder="Notes, directions, tips..." style="min-height:70px;resize:vertical;"></textarea>
      </div>

      <div class="form-group">
        <label>// Image Filename (optional)</label>
        <input type="text" id="m-img" placeholder="e.g. maze_bank.jpg">
        <div class="form-hint">// Place image in images/locations/ folder</div>
      </div>

      <div class="form-group">
        <label>// Category</label>
        <select id="m-cat">
          <option value="poi">ğŸ“ Point of Interest</option>
          <option value="base">ğŸ  Base / Safe House</option>
          <option value="mission">ğŸ¯ Mission Location</option>
          <option value="loot">ğŸ’° Loot / Stash</option>
          <option value="danger">âš ï¸ Danger Zone</option>
          <option value="vehicle">ğŸš— Vehicle Spawn</option>
          <option value="other">ğŸ“Œ Other</option>
        </select>
      </div>

      <div class="form-group">
        <label>// Minimum Access Level to View</label>
        <select id="m-vis">
          <option value="1">ğŸŒ Level 1+ â€” Public (all members)</option>
          <option value="2">ğŸ”’ Level 2+ â€” Restricted (Operative+)</option>
          <option value="3">ğŸ” Level 3+ â€” Confidential (Lieutenant+)</option>
          <option value="4">â›” Level 4 â€” Top Secret (Commander only)</option>
        </select>
        <div class="form-hint">// Users below this level cannot see this marker</div>
      </div>

    </div>
    <div class="modal-footer">
      <button class="btn-secondary" onclick="DM.map.closeAddModal()">Cancel</button>
      <button class="btn-primary" id="modal-save-btn" onclick="DM.map.saveMarker()"
              style="font-size:16px;padding:10px 24px;">SAVE LOCATION</button>
    </div>
  </div>
</div>

<!-- â”€â”€ MARKER POPUP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="marker-popup hidden" id="marker-popup">
  <div class="popup-img-wrap">
    <div id="popup-img-wrap"></div>
    <div class="popup-img-overlay"></div>
    <div class="popup-zone-badge" id="popup-zone-badge">Los Santos</div>
    <button class="popup-close" onclick="DM.map.closePopup()">âœ•</button>
  </div>
  <div class="popup-body">
    <div class="popup-name" id="popup-name"></div>
    <div class="popup-desc" id="popup-desc"></div>
    <div class="popup-tags">
      <span class="popup-cat-tag" id="popup-cat"></span>
      <span id="popup-vis"></span>
    </div>
    <div class="popup-meta" id="popup-meta"></div>
  </div>
  <div class="popup-footer hidden" id="popup-footer">
    <button class="btn-danger" style="width:100%;" onclick="DM.map.deleteCurrentMarker()">
      ğŸ—‘ Delete Location
    </button>
  </div>
</div>

<!-- â”€â”€ USER MANAGEMENT MODAL (Commander only) â”€â”€â”€â”€â”€â”€â”€ -->
<div class="modal-overlay hidden" id="user-modal">
  <div class="modal" style="max-width:600px;">
    <div class="modal-header">
      <span class="modal-icon">ğŸ‘¥</span>
      <div class="modal-title">USER MANAGEMENT</div>
      <button class="modal-close" onclick="DM.map.closeUserMgmt()">âœ•</button>
    </div>
    <div class="modal-body">

      <div id="user-list">
        <div class="loading-text">// LOADING USERS...</div>
      </div>

      <div class="add-user-form">
        <div class="add-user-form-title">// ADD NEW USER</div>
        <div class="add-user-grid">
          <div class="form-group">
            <label>Username</label>
            <input type="text" id="nu-username" placeholder="callsign" autocapitalize="none">
          </div>
          <div class="form-group">
            <label>Password</label>
            <input type="password" id="nu-password" placeholder="password">
          </div>
          <div class="form-group">
            <label>Display Name</label>
            <input type="text" id="nu-display" placeholder="Full name">
          </div>
          <div class="form-group">
            <label>Access Level</label>
            <select id="nu-level">
              <option value="1">Level 1 â€” Recruit</option>
              <option value="2">Level 2 â€” Operative</option>
              <option value="3">Level 3 â€” Lieutenant</option>
              <option value="4">Level 4 â€” Commander</option>
            </select>
          </div>
        </div>
        <button class="btn-primary" style="font-size:15px;padding:9px 22px;"
                onclick="DM.map.addNewUser()">ADD USER</button>
      </div>

    </div>
    <div class="modal-footer">
      <button class="btn-secondary" onclick="DM.map.closeUserMgmt()">Close</button>
    </div>
  </div>
</div>

<!-- Toast notification -->
<div class="toast" id="toast"></div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<!-- App scripts (order matters) -->
<script src="js/config.js"></script>
<script src="js/auth.js"></script>
<script src="js/db.js"></script>
<script src="js/nav.js"></script>
<script src="js/map.js"></script>

<script>
  // Init nav (checks auth + injects nav bar)
  const currentUser = DM.nav.init();

  // Init map module
  if (currentUser) {
    DM.map.init(currentUser);
  }
</script>
</body>
</html>
